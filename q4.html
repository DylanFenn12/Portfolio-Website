<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Puzzle – Question 4</title>
    <link rel="stylesheet" href="style.css" />

    <script>
      // Gatekeeper: must have completed Q3
      if (localStorage.getItem("puzzleProgress") !== "q3") {
        window.location.href = "q1.html";
      }
    </script>

    <style>
      input[type="text"] {
        width: 100%;
        padding: 0.75rem 0.9rem;
        border-radius: 0.75rem;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: #020617;
        color: #e5e7eb;
        font-size: 0.9rem;
        font-family: "JetBrains Mono", monospace;
      }

      input::placeholder {
        color: #6b7280;
      }

      /* Disable selection of text */
      .no-select,
      .no-copy {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      .no-copy {
        pointer-events: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="no-select no-copy"
          oncopy="return false"
          oncut="return false"
          onpaste="return false"
          oncontextmenu="return false">
        Question 4 – The Crab Song
      </h1>

      <p class="subtitle no-select no-copy"
         oncopy="return false"
         oncut="return false"
         onpaste="return false"
         oncontextmenu="return false">
        Read the text below. Then follow the instructions carefully.
        <strong>This question is case-sensitive.</strong>
      </p>

      <div class="question-block no-copy"
           oncopy="return false"
           oncut="return false"
           onpaste="return false"
           oncontextmenu="return false">
        <div class="question-title no-select">The song (Just try to copy it)</div>

        <div class="question-text no-select">
I am a crab, I am the lowest form on the island, I am useful only in my uselessness, I am a stench in the nose of God.
        </div>
      </div>

      <div class="question-block no-copy"
           oncopy="return false"
           oncut="return false"
           onpaste="return false"
           oncontextmenu="return false">
        <div class="question-title no-select">Your task</div>

        <div class="question-text no-select">
          TYPE IT.<br /><br />
          All you need to do is type <strong>The Crab Song.</strong><br /><br />
          This is <strong>case-sensitive</strong> and <strong>punctuation-sensitive</strong>.
        </div>
      </div>

      <form class="form-row" onsubmit="checkCrab(event)">
        <input
          id="answer"
          type="text"
          placeholder="Hurry Up."
          autocomplete="off"
          required
          onpaste="return false"
          oncopy="return false"
          oncut="return false"
          oncontextmenu="return false"
          ondragstart="return false"
          ondrop="return false"
        />
        <button type="submit">Check &amp; Continue</button>
      </form>

      <details class="no-copy"
               oncopy="return false"
               oncut="return false"
               onpaste="return false"
               oncontextmenu="return false">
        <summary>Hint</summary>
        <p class="no-select">
          Yall so stupid you needed a hint.
        </p>
      </details>

      <div class="footer no-select no-copy"
           oncopy="return false"
           oncut="return false"
           onpaste="return false"
           oncontextmenu="return false">
        <span class="progress">Step 4 / 25</span>
        <span class="reset-note">Any typo sends you back to Question 1.</span>
      </div>
    </div>

    <script>
      const correctPhrase = "The Crab Song.";

      function checkCrab(event) {
        event.preventDefault();
        const input = document.getElementById("answer");
        const user = input.value; // case-sensitive, no trimming

        if (user === correctPhrase) {
          // Mark Q4 as completed
          localStorage.setItem("puzzleProgress", "q4");
          window.location.href = "q5.html";
        } else {
          // Reset progress and send back to start
          localStorage.removeItem("puzzleProgress");
          alert("✖ Incorrect (remember: case and period matter). Back to the beginning.");
          window.location.href = "q1.html";
        }
      }
    </script>
  </body>
</html>
